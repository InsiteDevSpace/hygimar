<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <title>HYGIMAR - Produit <%= product.name %></title>

    <meta name="keywords" content="HTML5 Template" />
    <meta name="description" content="Porto - Bootstrap eCommerce Template" />
    <meta name="author" content="SW-THEMES" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/x-icon"
      href="/assets/images/icons/favicon.png"
    />

    <script>
      WebFontConfig = {
        google: {
          families: [
            "Open+Sans:300,400,600,700,800",
            "Poppins:200,300,400,500,600,700,800",
            "Oswald:300,400,500,600,700,800",
          ],
        },
      };
      (function (d) {
        var wf = d.createElement("script"),
          s = d.scripts[0];
        wf.src = "/assets/js/webfont.js";
        wf.async = true;
        s.parentNode.insertBefore(wf, s);
      })(document);
    </script>

    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />

    <!-- Main CSS File -->
    <link rel="stylesheet" href="/assets/css/demo35.min.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/vendor/fontawesome-free/css/all.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/vendor/simple-line-icons/css/simple-line-icons.min.css"
    />
  </head>

  <body>
    <div class="page-wrapper">
      <%- include('partials/header.ejs', { categories: categories, marks: marks
      }) %>

      <main class="main">
        <div class="container">
          <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="/"><i class="icon-home"></i></a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                <a href="#">Produits</a>
              </li>
            </ol>
          </nav>

          <div class="product-single-container product-single-default">
            <div class="cart-message d-none">
              <strong class="single-cart-notice">“<%= product.name %>”</strong>
              <span>a été ajouté à votre panier.</span>
            </div>

            <div class="row">
              <div class="col-lg-5 col-md-6 product-single-gallery">
                <div class="product-slider-container">
                  <div
                    class="product-single-carousel owl-carousel owl-theme show-nav-hover"
                  >
                    <% product.images.forEach(image => { %>
                    <div class="product-item">
                      <img
                        class="product-single-image"
                        src="<%= IMAGE_BASE_URL %>/<%= image %>"
                        data-zoom-image="<%= IMAGE_BASE_URL %>/<%= image %>"
                        width="468"
                        height="468"
                        alt="product"
                      />
                    </div>
                    <% }); %>
                  </div>
                  <span class="prod-full-screen">
                    <i class="icon-plus"></i>
                  </span>
                </div>

                <div class="prod-thumbnail owl-dots">
                  <% product.images.forEach(image => { %>
                  <div class="owl-dot">
                    <img
                      src="<%= IMAGE_BASE_URL %>/<%= image %>"
                      width="110"
                      height="110"
                      alt="product-thumbnail"
                    />
                  </div>
                  <% }); %>
                </div>
              </div>
              <!-- End .product-single-gallery -->

              <div class="col-lg-7 col-md-6 product-single-details">
                <h1 class="product-title"><%= product.name %></h1>

                <hr class="short-divider" />
                <!-- End .price-box -->

                <div class="product-desc">
                  <p>
                    <%- product.description.length > 150 ?
                    product.description.substring(0, 150) + '...' :
                    product.description %>
                  </p>
                </div>

                <!-- End .product-desc -->

                <ul class="single-info-list">
                  <% if (product.id_mark) { %>

                  <li>
                    MARQUE:
                    <strong
                      ><a
                        href="/marque/<%= product.id_mark._id %>"
                        class="product-category"
                        ><%= product.id_mark.mark_name %></a
                      ></strong
                    >
                  </li>
                  <% } %>
                  <li>
                    CATEGORIE:
                    <strong>
                      <a
                        href="/categorie/<%= product.id_catg._id %>"
                        class="product-category"
                      >
                        <%= product.id_catg.catg_name %>
                      </a>
                    </strong>
                  </li>

                  <% if (product.id_subcatg) { %>
                  <li>
                    SUBCATEGORIE:
                    <strong>
                      <a
                        href="/subcategorie/<%= product.id_subcatg._id %>"
                        class="product-category"
                      >
                        <%= product.id_subcatg.subcatg_name %>
                      </a>
                    </strong>
                  </li>
                  <% } %> <% if (product.tec_sheet) { %>

                  <li>
                    DECOUVRIR LA
                    <strong>
                      <a
                        href="<%= IMAGE_BASE_URL %>/<%= product.tec_sheet %>"
                        target="_blank"
                        class="product-category"
                        style="color: #fd5b5a"
                        >FICHE TECHNIQUE</a
                      >
                    </strong>
                  </li>
                  <% } %>
                </ul>

                <div class="product-action">
                  <!-- End .product-single-qty -->

                  <a
                    href="javascript:;"
                    class="btn btn-dark add-cart font1 mr-2"
                    title="Add to Cart"
                    data-product-id="<%= product._id %>"
                    >Demander un Devis</a
                  >
                </div>
                <!-- End .product-action -->

                <hr class="divider mb-0 mt-0" />

                <div class="product-single-share mb-3">
                  <label class="sr-only">Partager:</label>

                  <div class="social-icons mr-2">
                    <a
                      href="#"
                      class="social-icon social-facebook icon-facebook"
                      target="_blank"
                      title="Facebook"
                    ></a>
                    <a
                      href="#"
                      class="social-icon social-twitter icon-twitter"
                      target="_blank"
                      title="Twitter"
                    ></a>
                    <a
                      href="#"
                      class="social-icon social-linkedin fab fa-linkedin-in"
                      target="_blank"
                      title="Linkedin"
                    ></a>
                    <a
                      href="#"
                      class="social-icon social-gplus fab fa-google-plus-g"
                      target="_blank"
                      title="Google +"
                    ></a>
                    <a
                      href="#"
                      class="social-icon social-mail icon-mail-alt"
                      target="_blank"
                      title="Mail"
                    ></a>
                  </div>
                  <!-- End .social-icons -->
                </div>
                <!-- End .product single-share -->
              </div>
              <!-- End .product-single-details -->
            </div>
            <!-- End .row -->
          </div>
          <!-- End .product-single-container -->

          <div class="product-single-tabs">
            <ul class="nav nav-tabs" role="tablist">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  id="product-tab-desc"
                  data-toggle="tab"
                  href="#product-desc-content"
                  role="tab"
                  aria-controls="product-desc-content"
                  aria-selected="true"
                  >Description</a
                >
              </li>
            </ul>

            <div class="tab-content font2">
              <div
                class="tab-pane fade show active"
                id="product-desc-content"
                role="tabpanel"
                aria-labelledby="product-tab-desc"
              >
                <div class="product-desc-content">
                  <p><%- product.description %></p>
                </div>
                <!-- End .product-desc-content -->
              </div>
              <!-- End .tab-pane -->

              <div
                class="tab-pane fade"
                id="product-reviews-content"
                role="tabpanel"
                aria-labelledby="product-tab-reviews"
              >
                <div class="product-reviews-content">
                  <h3 class="reviews-title">
                    1 review for Men Black Sports Shoes
                  </h3>
                  <div class="comment-list">
                    <div class="comments">
                      <figure class="img-thumbnail">
                        <img
                          src="assets/images/blog/author.jpg"
                          alt="author"
                          width="80"
                          height="80"
                        />
                      </figure>
                      <div class="comment-block">
                        <div class="comment-header">
                          <div class="comment-arrow"></div>
                          <div class="ratings-container float-sm-right">
                            <div class="product-ratings">
                              <span class="ratings" style="width: 60%"></span
                              ><!-- End .ratings -->
                              <span class="tooltiptext tooltip-top"></span>
                            </div>
                            <!-- End .product-ratings -->
                          </div>
                          <span class="comment-by">
                            <strong>Joe Doe</strong> – April 12, 2018
                          </span>
                        </div>
                        <div class="comment-content">
                          <p>Excellent.</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="divider"></div>

                  <!-- End .add-product-review -->
                </div>
                <!-- End .product-reviews-content -->
              </div>
              <!-- End .tab-pane -->
            </div>
            <!-- End .tab-content -->
          </div>
          <!-- End .product-single-tabs -->

          <div class="products-section pt-0">
            <h2 class="section-title m-b-4">
              Produits apparentés ou complémentaires
            </h2>
            <div class="row">
              <div
                class="products-slider owl-carousel owl-theme dots-top dots-small mb-0"
                data-owl-options="{'margin': 0}"
              >
                <!-- Example of related product -->
                <% products.forEach(relatedProduct => { %>
                <div class="product-default inner-quickview inner-icon">
                  <figure>
                    <a href="/produit/<%= relatedProduct._id %>">
                      <img
                        src="<%= IMAGE_BASE_URL %>/<%= relatedProduct.primaryImage %>"
                        width="217"
                        height="217"
                        alt="product"
                      />
                    </a>

                    <div class="btn-icon-group">
                      <a
                        href="/produit/<%= relatedProduct._id %>"
                        class="btn-icon btn-add-cart product-type-simple"
                        ><i class="icon-shopping-cart"></i
                      ></a>
                    </div>
                    <a
                      href="/produit/<%= relatedProduct._id %>"
                      class="btn-quickview"
                      title="Quick View"
                      >VOIR PLUS</a
                    >
                  </figure>
                  <div class="product-details">
                    <div class="category-wrap">
                      <div class="category-list">
                        <a href="#" class="product-category"
                          ><%= relatedProduct.id_catg.catg_name %></a
                        >
                      </div>
                    </div>
                    <h3 class="product-title">
                      <a href="/produit/<%= relatedProduct._id %>"
                        ><%= relatedProduct.name %></a
                      >
                    </h3>

                    <!-- End .price-box -->
                  </div>
                  <!-- End .product-details -->
                </div>
                <% }); %>
              </div>
              <!-- End .products-slider -->
            </div>
          </div>
          <!-- End .products-section -->
        </div>
        <!-- End .container -->
      </main>
      <!-- End .main -->

      <!-- End .main -->

      <!-- End .main -->

      <%- include('partials/footer.ejs', { categories: categories, marks: marks
      }) %>
    </div>
    <!-- End .page-wrapper -->

    <div class="loading-overlay">
      <div class="bounce-loader">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>
    </div>

    <div class="mobile-menu-overlay"></div>
    <!-- End .mobil-menu-overlay -->

    <%- include('partials/menu-mobile.ejs', { categories: categories, marks:
    marks }) %>

    <!-- Modal -->
    <div
      style="background-color: #4783b257"
      class="modal fade"
      id="orderModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="orderModalLabel"
      aria-hidden="true"
    >
      <div
        class="modal-dialog modal-dialog-centered"
        role="document"
        style="max-width: 500px"
      >
        <div class="modal-content">
          <div class="modal-header border-0">
            <h3
              class="modal-title"
              style="font-weight: 800"
              id="orderModalLabel"
            >
              Demander un Devis
            </h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="orderForm">
              <div class="form-group">
                <label for="fullname">Nom Complet</label>
                <input
                  type="text"
                  class="form-control"
                  id="fullname"
                  name="fullname"
                  required
                  placeholder="Entrer votre nom et prenom"
                />
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  required
                  placeholder="Entrer votre email"
                />
              </div>
              <div class="form-group">
                <label for="business">Business</label>
                <input
                  type="text"
                  class="form-control"
                  id="business"
                  name="business"
                  placeholder="Entrer votre nom de business"
                />
              </div>
              <div class="form-group">
                <label for="phone">Phone</label>
                <input
                  type="text"
                  class="form-control"
                  id="phone"
                  name="phone"
                  placeholder="Entrer votre numero"
                />
              </div>
              <div class="form-group">
                <label for="message">Message</label>
                <textarea
                  class="form-control"
                  id="message"
                  name="message"
                  placeholder="Entrer votre message"
                  rows="4"
                ></textarea>
              </div>
              <input type="hidden" id="productId" name="productId" />
              <div class="form-group text-center">
                <button type="submit" class="btn btn-primary btn-block">
                  Demander
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <!-- Success Modal -->
    <div
      class="modal fade"
      id="successModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="successModalLabel"
      aria-hidden="true"
      style="background-color: rgba(71, 131, 178, 0.34)"
    >
      <div
        class="modal-dialog modal-dialog-centered"
        role="document"
        style="max-width: 600px"
      >
        <div class="modal-content">
          <div class="modal-header border-0">
            <h3
              class="modal-title"
              style="font-weight: 800"
              id="successModalLabel"
            >
              Commande créée avec succès
            </h3>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" style="text-align: center">
            <p>
              Votre commande a été créée avec succès. Merci pour votre requête!
              nous vous contacterons dès que possible.
            </p>
            <div class="form-group text-center">
              <button
                type="button"
                class="btn btn-primary btn-block"
                data-dismiss="modal"
              >
                Fermer
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <a id="scroll-top" href="#top" title="Top" role="button"
      ><i class="icon-angle-up"></i
    ></a>

    <!-- Plugins JS File -->
    <script src="/assets/js/jquery.min.js"></script>

    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/plugins.min.js"></script>
    <script src="/assets/js/nouislider.min.js"></script>
    <script src="/assets/js/jquery.plugin.min.js"></script>
    <script src="/assets/js/jquery.countdown.min.js"></script>

    <!-- Main JS File -->
    <script src="/assets/js/main.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelector(".add-cart")
          .addEventListener("click", (event) => {
            const productId = event.target.getAttribute("data-product-id");
            document.getElementById("productId").value = productId;
            $("#orderModal").modal("show");
          });

        document
          .querySelector("#orderForm")
          .addEventListener("submit", async (event) => {
            event.preventDefault();

            const clientDetails = {
              fullname: document.getElementById("fullname").value,
              email: document.getElementById("email").value,
              business: document.getElementById("business").value,
              phone: document.getElementById("phone").value,
              message: document.getElementById("message").value,
            };

            const productId = document.getElementById("productId").value;

            const orderDetails = {
              products: [{ product_id: productId, quantity: 1 }],
              sendNotif: true,
              notes: "Sample notes",
            };

            try {
              const response = await fetch("/api/order/createfrom", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ clientDetails, orderDetails }),
              });

              const result = await response.json();

              if (response.ok) {
                $("#orderModal").modal("hide");
                $("#successModal").modal("show");
              } else {
                alert(`Error: ${result.error}`);
              }
            } catch (error) {
              console.error("Error creating order:", error);
              alert("Error creating order");
            }
          });
      });
    </script>
  </body>
</html>
